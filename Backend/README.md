## 表格与查询

不知道你是否使用过 EXCEL 文档。一个 EXCEL 文档中的“学生”**表格**会是下面的样子：

`“学生”表`

|       |   姓名   |   性别   | 年龄 |   当前班级   | 大一所在班级 |   学号   |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 1 | 小张 | 女 | 20 | 计科1901 | 工信1918 | 3190101234 |
| 2 | 小胡 | 男 | 19 | 工信2017 |          | 3200105678 |
| 3 | 小王 | 女 | 21 | 机械1802 | 机材1801 | 3180109012 |

显然，第一行与第一列中的单元格，相比于其他单元格，它们的“地位”是不同的。除了第一行与第一列以外，其余的每一个单元格都存储了**数据**。
在这个表中，每一**列**存储的都是一类信息，比如姓名、性别信息等等。而每一**行**存储的则是一个人的基本信息。
行与列是这个表基础的特性。我们平常查询 EXCEL 表格的时候，可以有多种“看法”。请思考一下，如果你想查询某种信息，你会如何“看这个表”。  

### 查询小张的所有信息
1. 在“姓名”**列**里找到“小张”所在的单元格（为了简化问题，我们不妨假设表里只有一个“小张”）
2. 查看该单元格所在**行**的**所有**信息

### 查询小张的当前班级
1. 在“姓名”**列**里找到“小张”（为了简化问题，我们不妨假设表里只有一个“小张”）
2. 查看“小张”所在的**行**，从该行里找到“当前班级”**列**中的单元格

### 查询**所有**年龄大于19的人的姓名
1. 在“年龄”列里找到所有大于19的单元格
2. 查看这些单元格所在的**行**，从这些行里找到“姓名”**列**中的单元格

我们不难发现，这些较为简单的查询过程往往可以归纳为以下两部分：

| 目标（未知信息） | 条件（已知信息） |
| :---: | :---: |
| （所有信息） | 姓名=小张 |
| 当前班级 | 姓名=小张 |
| 姓名 | 年龄>19 |



## 认识 SQL

当我们尝试使用计算机对表格进行查询时，就不得不使用一种*计算机语言*对数据库进行查询。这种计算机语言就是SQL。
SQL 的全称是 Structured Query Language，结构化查询语言。也许你之前见过C语言，而我们这里提到的SQL与C语言同为编程语言，但“看起来”还是不太一样。
在计算机里，我们一般都使用英文。我们不妨用英文把刚刚的表格改写一下：  

`table "students"`

| id |   name   | gender | age | current_class | freshman_class | zju_id |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 1 | 小张 | 女 | 20 | 计科1901 | 工信1918 | 3190101234 |
| 2 | 小胡 | 男 | 19 | 工信2017 |          | 3200105678 |
| 3 | 小王 | 女 | 21 | 机械1802 | 机材1801 | 3180109012 |

在数据库中，我们需要一列**互不相同** (unique) 的信息，来指明我们到底要操作什么。其他单元格可以任意地出现重复，但这一列一定不能重复。在上面展示的表格中，充当这个唯一信息的一列就是`id`列，它以**自增** (auto increment) 的方式，从1开始，持续上升。由于这一列在表格中的特殊地位，我们称 “`id`是 student 表的**主键** (primary key)”。 一个表中只能有一个主键。主键不一定是自增的，但该列的元素必须是互不相同的。

那么，在上一节中，我们提到的三次查询，可以分别写作三个SQL语句：  
```sql
SELECT * FROM students WHERE name='小张';
SELECT current_class FROM students WHERE name='小张';
SELECT name FROM students WHERE age>19;
```
其中，student 是表格的名字。事实上，在一个**数据库**中，存在着很多**表格**。student 表是数据库中的一个表格。
第一条SQL语句中的`*`的含义是“所有”。  

我们发现，查询的**目标**被写在了`SELECT`关键字后面，查询的**条件**被写在了`WHERE`关键字后面。整个SQL语句读起来，非常接近自然语言。
这三条SQL语句的结果分别如下：  

```plain

 id | name | gender | age | current_class | freshman_class |   zju_id   |
----+------+--------+-----+---------------+----------------+------------+
  1 | 小张  |  女    |  20 | 计科1901      | 工信1918        | 3190101234 


 current_class 
---------------
 计科1901


 name 
------
 小张
 小王
```


至此，你已经成功入门了SQL。接下来的内容需要你自己进行学习与思考：

1. 以上介绍的内容**查询**语句。后端开发者与数据库进行交互的过程中，他们除了**查询**操作，还会进行**增添**、**删除**、**修改**，这四个操作合称**增删改查**，是后端开发的基石。你需要在互联网上搜索与它们相关的相关信息（如，搜索关键词：SQL删除语句），进行学习。
2. 思考一下，你在使用EXCEL的时候，会对表格进行什么样的查询操作？如果存在多个表格，它们之间存在关系，那么又会如何进行查询呢？

以上两道题目不需要你进行作答，但请一定按照题目要求进行学习或思考。这将对你顺利完成后续的题目有帮助。  



## 安装数据库与建表

常用的数据库有非常多，诸如微软的SQLserver，甲骨文的Mysql，非关系数据库MongoBb，Redis，等等等等。这里推荐安装开源免费且强大的[postgresql](https://www.postgresql.org/)，来作为本次试题的支持数据库。

**1-1**：安装postgresql，添加一个用户，为该用户新建一个数据库

**要求**：安装postgresql；登录数据库并在命令行中执行`SELECT version();`，获取postgresql的版本信息，并截图上传。（下图为windows下以postgres用户登录的示例图）

**提示**：由于不同操作系统诸如Mac OS，Windows，Linux安装postgresql的方法不尽相同，请参考[postgresql-download](https://www.postgresql.org/download/) 以及 [postgresql-tutorial](https://www.postgresqltutorial.com/postgresql-getting-started/) 并灵活使用搜索引擎，以解决遇到的问题。

![img](picture/Install-PostgreSQL-psql-verification.png)



光有数据库还不行，里面的数据才是有价值的东西，所以接下来，我们需要从零建表并添加几条记录。当然，达成这一目的的手段有很多，比如通过命令行，执行SQL脚本，使用可视化的界面，使用代码进行数据库迁移。这里要求以SQL脚本的形式建表并添加数据，希望你能了解一下SQL语句，动手写几行。

**1-2**：建表并添加记录

**要求**：根据以下字段信息，编写`1-2.sql`脚本并上传，实现创建`students`表格，并向该表格中插入上文提到的对应三条信息。

**提示**：创建数据库->连接数据库->执行SQL脚本；可以参考[pg-create table](https://www.postgresqltutorial.com/postgresql-create-table/)，并灵活使用搜索引擎。

| 字段           | 类型      | 要求                 |
| -------------- | --------- | -------------------- |
| id             | serial    | 自增，主键，非空     |
| name           | VARCHAR() | 长度不超过50的，非空 |
| age            | INT       | 非空                 |
| gender         | INT       | 非空，1男 2女[^1]    |
| current_class  | VARCHAR() | 长度不超过255，非空  |
| freshman_class | VARCHAR() | 长度不超过255        |
| zju_id         | BIGINT    | 独一无二，非空[^2]   |

[^1]:数据库存储性别的方式可以有很多，这里采用国标，1-男 2-女 ，其他特殊的请自行查询；当然你可以用字符串或一位字符来代表性别，这取决于你
[^2]:在具体问题环境下，zju_id会有更多的约束条件，你可以尝试想一下在当前涉及下会有哪些问题。



## Go

Go是一种开源的编程语言，由Google公司开发，目的在提高并发、网络通信等方面的开发效率。

Go的语法接近C，如果你有C语言的基础，那么上手Go相对容易，当然即使没有，你也可以查看[go-doc](https://golang.org/doc/)[^3]以及[the-little-go-book](https://github.com/karlseguin/the-little-go-book/blob/master/en/go.md)掌握go的基础语法。

[^3]:由于“墙”的存在，可能有无法访问，请自行探索解决方法，或灵活使用搜索引擎对go进行入门。

**2-1**：配置go语言环境，于命令行执行`go version`，确认是否成功安装并将结果截图上传。

**提示**：不同系统安装方式不同，可以参考[go-install](https://golang.org/doc/install)



### ORM

程序和数据库交互的方式有很多，通过底层的代码直接执行SQL语句，就像我们在命令行或使用SQL脚本一样，去与数据库进行交互。这种方法执行效率高，但是不利于程序开发，因为每遇到一个特定的业务场景，就需要为该场景编写特定的SQL语句，交给底层代码执行，开发效率稍低。而另一种交互方式，便是让程序通过ORM框架，操作数据库。

何为ORM？Object Relational Mapping，即对象关系映射。通过把数据库里的关系、数据映射到对象上，使得程序员能通过面向对象的设计模式管理操纵数据，提高了开发效率。

当然，ORM是一种程序设计技术，具体语言对ORM这一思路的实现，被称作ORM框架。[gorm](https://gorm.io/index.html)便是go对ORM设计思路的具体实现之一。

**2-2**：通过go的包管理器安装gorm以及postgres的支持包，编写`main.go`实现以下过程并上传

- 通过连接字符串连接到你的数据库[^4]
- 向数据库中添加一条你的记录
- 根据**1-2**中你添加的记录，查询小张的学号，并输出至控制台；
- 查询年龄大于19的同学，输出其姓名至控制台；
- 查询并删除你自己的记录

**提示**：请参考[go-orm-doc](https://gorm.io/docs/)，并灵活使用搜索引擎解决开发过程中的问题。

[^4]:这里为了方便，你可以选择直接将数据库用户名和密码硬编码进代码；**但是请注意，在真正开发或部署时，不要直接将敏感数据（如数据库密码）硬编码进程序，这可能会导致数据安全的问题！！！**